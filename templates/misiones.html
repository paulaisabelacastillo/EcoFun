<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>ðŸ§© Earth Quest â€“ 365 Misiones</title>
  <link rel="stylesheet" href="../static/misiones.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>ðŸ§© Earth Quest â€“ 365 Misiones</h1>
      <p>Elige el dÃ­a y completa tu misiÃ³n para ayudar al planeta ðŸŒŽ</p>
      <p id="contador-misiones">Misiones completadas: 0 âœ…</p>
    </header>

    <main class="calendar">
      <!-- DÃ­as de la semana -->
      <div class="day-name">Dom</div>
      <div class="day-name">Lun</div>
      <div class="day-name">Mar</div>
      <div class="day-name">MiÃ©</div>
      <div class="day-name">Jue</div>
      <div class="day-name">Vie</div>
      <div class="day-name">SÃ¡b</div>

      <!-- Ejemplo de primeros 7 dÃ­as -->
      <div class="day" onclick="mostrarMision(1)">1</div>
      <div class="day" onclick="mostrarMision(2)">2</div>
      <div class="day" onclick="mostrarMision(3)">3</div>
      <div class="day" onclick="mostrarMision(4)">4</div>
      <div class="day" onclick="mostrarMision(5)">5</div>
      <div class="day" onclick="mostrarMision(6)">6</div>
      <div class="day" onclick="mostrarMision(7)">7</div>

      <!-- Popup misiÃ³n -->
      <div id="mision" class="mision-popup">
        <p id="mision-texto"></p>
        <button onclick="completarMision()">Â¡MisiÃ³n cumplida!</button>
        <button onclick="cerrarMision()">Cerrar</button>
      </div>
    </main>

    <footer>
      Â© 2025 EcoFun â€“ Â¡Una misiÃ³n a la vez, cambiamos el mundo!
    </footer>
  </div>

  <script>
    const misiones = {
      1: "â™»ï¸ MisiÃ³n 1: Separa correctamente tus residuos hoy.",
      2: "ðŸ’§ MisiÃ³n 2: Ahorra 5 minutos en tu ducha.",
      3: "ðŸŒ± MisiÃ³n 3: Planta una semilla o cuida una planta.",
      4: "ðŸš´ MisiÃ³n 4: Usa la bicicleta o camina si puedes.",
      5: "ðŸ“´ MisiÃ³n 5: Desconecta cargadores innecesarios.",
      6: "ðŸ›ï¸ MisiÃ³n 6: Usa bolsa reutilizable para tus compras.",
      7: "ðŸ“š MisiÃ³n 7: Aprende algo nuevo sobre el clima."
    };
  
    let diaActual = null;
  
    function mostrarMision(dia) {
      diaActual = dia;
      document.getElementById("mision-texto").innerText = misiones[dia] || "ðŸŒ No hay misiÃ³n para este dÃ­a aÃºn.";
      document.getElementById("mision").style.display = "block";
    }
  
    function cerrarMision() {
      document.getElementById("mision").style.display = "none";
    }
  
    function completarMision() {
      if (diaActual) {
        fetch("/completar", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ dia: diaActual })
        })
        .then(response => response.json())
        .then(data => {
          document.getElementById("contador-misiones").innerText = `Misiones completadas: ${data.completadas} âœ…`;
          // Marcar botÃ³n como completado
          const diaBoton = document.querySelector(`.day[onclick="mostrarMision(${diaActual})"]`);
          if (diaBoton) {
            diaBoton.classList.add("completado");
          }
          cerrarMision();
        });
      }
    }
  
    // Al cargar la pÃ¡gina
    window.onload = function () {
      fetch("/conteo")
        .then(response => response.json())
        .then(data => {
          document.getElementById("contador-misiones").innerText = `Misiones completadas: ${data.completadas} âœ…`;
          // Marcar visualmente los dÃ­as completados
          data.dias.forEach(dia => {
            const diaBoton = document.querySelector(`.day[onclick="mostrarMision(${parseInt(dia)})"]`);
            if (diaBoton) {
              diaBoton.classList.add("completado");
            }
          });
        });
    };
  </script>
  
  
</body>
</html>
